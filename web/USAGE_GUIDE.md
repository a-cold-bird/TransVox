# TransVox Web 使用指南

## 🚀 快速开始

### 1. 安装和启动

```bash
cd web
npm install
npm run dev
```

访问: http://localhost:3000

### 2. 首次使用配置

1. 访问 **设置页面** (`/settings`)
2. 配置 API 连接信息
3. 设置默认语言偏好
4. 保存设置

## 📖 功能使用指南

### 工作空间 - 完整翻译流程

#### 步骤 1: 上传视频
- 拖拽视频文件到上传区域
- 或点击选择文件
- 支持格式: MP4, MKV, AVI, MOV, WebM

#### 步骤 2: 基础配置
- **源语言**: 选择视频原始语言
- **目标语言**: 选择要翻译成的语言
- **TTS 引擎**: 
  - GPT-SoVITS (质量更好)
  - IndexTTS (速度更快)
- **字幕模式**:
  - Hardcode: 烧录到画面（永久，文件大）
  - Soft: 内嵌可关闭（推荐，文件小）
  - External: 外挂文件（最灵活）
  - Both: 软字幕+外挂（最完整）

#### 步骤 3: 高级配置（可选）

点击展开"高级设置"，可以调整：

**音频处理**
- 采样率: 44100 Hz (推荐)
- 声道: 立体声

**TTS 参数**
- Temperature: 1.0 (越高越有变化)
- Top P: 0.8 (控制采样随机性)
- Top K: 20 (限制候选token数量)
- 批处理大小: 4 (根据显存调整)

**字幕处理**
- 最大行字符数: 40 (中文推荐 20-30)
- 字幕字号: 15
- AI 智能分行: ✓ (推荐开启)
- 双语字幕: 根据需要

**视频编码**
- 编码器: H.264 (兼容性好)
- CRF: 23 (18-28 为佳，越小质量越好)

#### 步骤 4: 启动处理

点击"启动流水线"按钮，然后：
- 观察右侧进度条
- 查看当前处理步骤
- 已完成步骤会显示 ✓

#### 步骤 5: 下载结果

处理完成后，根据字幕模式：
- Hardcode: 下载视频（字幕已烧录）
- Soft: 下载视频（字幕可关闭）
- External: 下载视频 + .srt + .ass 文件
- Both: 下载视频（含软字幕）+ 外挂字幕文件

---

### 字幕编辑器 - 专业字幕处理

#### 使用场景
1. 编辑已有字幕
2. 调整字幕样式
3. 转换字幕格式
4. 预览字幕效果

#### 详细步骤

**1. 准备工作**
- 上传视频文件（用于预览）
- 准备好 SRT/VTT/ASS 字幕文件

**2. 导入字幕**
- 点击"导入"按钮
- 选择字幕文件
- 支持 SRT, VTT, ASS 三种格式
- 字幕会自动解析并按时间排序

**3. 编辑字幕**

每条字幕可以编辑：
- **序号**: 点击可跳转到视频对应时间
- **开始时间**: 格式 `HH:MM:SS,mmm`
- **结束时间**: 格式 `HH:MM:SS,mmm`
- **文本内容**: 支持多行

**编辑技巧**:
- 播放视频到目标位置
- 点击"添加"创建新字幕（自动使用当前时间）
- 点击字幕序号跳转到对应时间点
- 边看边改，实时预览

**4. 调整样式**

左下方的样式设置面板：
- **字体**: Arial, 微软雅黑, 黑体, 霞鹜文楷
- **字号**: 10-60px，推荐 15-24
- **文字颜色**: 点击色块或输入 HEX 值
- **描边颜色**: 增加可读性（推荐黑色）
- **描边宽度**: 0-10px，推荐 1-3
- **粗体/斜体**: 勾选开启
- **对齐**: 左/中/右

**样式提示**:
- 白色文字 + 黑色描边 = 最佳可读性
- 描边宽度 2-3px = 清晰且不过度
- 字号 15-20px = 适合大多数视频

**5. 实时预览**

在视频播放时：
- 字幕会自动叠加显示
- 当前播放的字幕在列表中高亮
- 样式修改立即生效
- 可以随时调整预览效果

**6. 导出字幕**

选择导出格式：
- **SRT**: 纯文本，通用性最好
- **VTT**: Web 播放器标准格式
- **ASS**: 保留所有样式设置

点击"导出"按钮，下载文件。

---

### 视频下载 - 在线视频翻译

#### 使用步骤

1. **输入视频 URL**
   - 支持 YouTube, Bilibili 等
   - 粘贴完整的视频链接

2. **选择选项**
   - 勾选"下载后自动翻译"可直接进入流水线

3. **开始下载**
   - 点击下载按钮
   - 等待下载完成

4. **后续处理**
   - 如果开启了自动翻译，会自动开始处理
   - 否则，可以在工作空间中手动配置

---

### 音频分离 - 提取人声和背景

#### 使用场景
- 获取纯人声用于训练
- 提取背景音乐
- 制作卡拉OK版本
- 音频后期处理

#### 操作步骤

1. **上传文件**
   - 可以上传视频（自动提取音频）
   - 也可以直接上传音频文件

2. **开始分离**
   - 点击"开始分离"
   - 等待处理（通常 1-3 分钟）

3. **下载结果**
   - 人声音轨 (vocals.wav)
   - 背景音乐 (instrumental.wav)
   - 无声视频 (video_only.mp4) - 如果上传的是视频

---

### 语音转录 - 生成字幕

#### 使用场景
- 快速生成字幕文件
- 无需翻译，只需转录
- 制作同语言字幕

#### 操作步骤

1. **上传媒体文件**
   - 视频或音频文件

2. **选择语言**
   - 选择音频中的语言
   - 准确的语言选择能提高识别率

3. **开始识别**
   - 点击"开始识别"
   - 等待转录完成

4. **下载字幕**
   - 下载生成的 SRT 文件
   - 可以导入到字幕编辑器进一步编辑

---

### 设置 - 全局配置

#### API 配置

**API Key**
- 某些翻译服务需要 API Key
- 在对应服务商获取
- 保存后全局生效

**Base URL**
- 后端 API 地址
- 默认: http://localhost:8000
- 如果部署在其他地址，修改此项

#### 翻译设置

**翻译服务商**
- Google Translate (免费，限额)
- DeepL (高质量)
- OpenAI (GPT 翻译)
- Gemini (Google AI)

**默认语言**
- 设置常用的源语言和目标语言
- 在工作空间中会自动应用

#### 项目设置

**输出目录**
- 设置文件保存位置
- 默认: `./output`

**自动编号** ⭐
- 开启后，每个项目自动生成编号文件夹
- 例如: `output/001_video1`, `output/002_video2`
- 方便管理多个项目

---

## 🎯 实用案例

### 案例 1: 翻译 YouTube 视频

1. 复制 YouTube 视频链接
2. 进入 `/tools/download`
3. 粘贴链接，勾选"自动翻译"
4. 等待下载和处理完成
5. 下载翻译后的视频

### 案例 2: 制作双语字幕

1. 在工作空间上传视频
2. 配置源语言和目标语言
3. 在高级设置中勾选"双语字幕"
4. 启动流水线
5. 获得同时显示两种语言的视频

### 案例 3: 编辑现有字幕

1. 进入字幕编辑器
2. 上传原视频
3. 导入现有 SRT 字幕
4. 边播放边修改文本
5. 调整样式
6. 导出为 ASS 格式（保留样式）

### 案例 4: 提取视频人声

1. 进入音频分离工具
2. 上传视频
3. 开始分离
4. 下载人声音轨
5. 用于其他用途（如训练 TTS）

---

## 💡 常见问题

### Q: 按钮没有响应？
A: 确保已正确安装依赖并启动开发服务器。检查浏览器控制台是否有错误。

### Q: 上传失败？
A: 检查后端服务器是否在运行（http://localhost:8000），查看 .env.local 配置。

### Q: 字幕预览不显示？
A: 确保已上传视频文件和导入字幕文件，播放视频到有字幕的时间段。

### Q: 导出的 ASS 字幕样式不对？
A: ASS 格式比较复杂，某些播放器可能不完全支持。建议用 VLC 或 PotPlayer 测试。

### Q: 语言切换后部分文本未翻译？
A: 刷新页面，或检查对应语言的翻译文件是否完整。

### Q: 高级设置不生效？
A: 高级设置需要后端 API 支持，确保后端已实现相应的参数处理。

---

## 📚 参考资料

### 快捷键

当前尚未实现，计划支持：
- `Space`: 播放/暂停
- `←/→`: 快进/快退
- `Ctrl+S`: 保存
- `Ctrl+E`: 导出

### 文件格式

**SRT 格式示例**:
```srt
1
00:00:01,000 --> 00:00:04,000
这是第一条字幕

2
00:00:05,000 --> 00:00:08,000
这是第二条字幕
```

**ASS 格式特点**:
- 支持复杂样式
- 可以定义多个样式
- 支持特效和动画
- 文件较大

### 最佳实践

1. **先配置后使用**: 在设置页面配置好再开始工作
2. **善用高级参数**: 根据需求调整参数获得最佳效果
3. **保存配置**: 常用参数保存在设置中
4. **字幕编辑**: 使用字幕编辑器精修字幕
5. **外挂优先**: 如果要修改字幕，建议使用外挂模式

---

**提示**: 遇到问题查看 TROUBLESHOOTING.md  
**更新**: 查看 COMPLETE_FEATURES.md 了解所有功能

